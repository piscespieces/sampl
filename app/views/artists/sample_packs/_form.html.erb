<%= form_with(model: sample_pack, url: local_assigns.fetch(:url, artists_sample_packs_path), multipart: true) do |form| %>
  <% if sample_pack.errors.any? %>
    <div style="color: red">
      <h2><%= pluralize(sample_pack.errors.count, "error") %> prohibited this sample_pack from being saved:</h2>
      <ul>
        <% sample_pack.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <%= form.hidden_field :artist_id, value: current_artist.id %>

  <div class="mb-6">
    <%= form.label :name, class: "block" %>
    <%= form.text_field :name, required: true, class: "text-input" %>
  </div>

  <div class="mb-6">
      <%= form.label :image, class: "block" %>
      <%= form.file_field :image %>
      <% if sample_pack.image.attached? && sample_pack.image.image? %>
        <%= image_tag(sample_pack.image, class: "w-48") %>
      <% end %>
  </div>

  <div data-controller="audio-preview" class="mb-6">
    <%= form.fields_for :samples do |s| %>
    <div class="mb-8">
      <%= s.hidden_field :audio, value: s.object.audio, data: { action: "change->audio-preview#getFileName" } %>
      <%= audio_tag(url_for(s.object.audio), controls: "") %>
      <%= s.file_field :audio, { accept: "audio/wav, audio/mp3" } %>
      <%= s.check_box :_destroy %>
    </div>
    <% end %>
    <%# TODO: How to send NAME attribute %>
    <%= file_field_tag("samples[]", {multiple: true, accept: "audio/wav, audio/mp3", data: { action: "change->audio-preview#getFileName" }}) %>
    <div id="audio-files-container">
    </div>
  </div>

  <div>
    <%= form.submit %>
  </div>
<% end %>
